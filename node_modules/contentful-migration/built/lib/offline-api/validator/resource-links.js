"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const __1 = require("../");
const resource_links_1 = require("../../utils/resource-links");
const errors_1 = __importDefault(require("./errors"));
class ResourceLinksValidator {
    constructor() {
        this.hooks = [__1.ApiHook.SaveContentType];
    }
    validate({ contentType }) {
        const errors = [];
        const fields = contentType.fields.toRaw();
        const resourceLinkCount = fields.filter(resource_links_1.isResourceLink).length;
        if (resourceLinkCount > resource_links_1.MAX_RESOURCE_LINKS) {
            errors.push({
                type: 'InvalidPayload',
                message: errors_1.default.contentType.TOO_MANY_RESOURCE_LINK_FIELDS(contentType.id)
            });
        }
        for (const field of fields) {
            if ((0, resource_links_1.isResourceLink)(field) && !field.allowedResources) {
                errors.push({
                    type: 'InvalidPayload',
                    message: errors_1.default.field.REQUIRED_DEPENDENT_PROPERTY('allowedResources', field.id, 'type', 'ResourceLink')
                });
            }
            if (!(0, resource_links_1.isResourceLink)(field) && field.allowedResources) {
                errors.push({
                    type: 'InvalidPayload',
                    message: errors_1.default.field.FORBIDDEN_DEPENDENT_PROPERTY('allowedResources', field.id, 'type', 'ResourceLink')
                });
            }
        }
        return errors;
    }
}
exports.default = ResourceLinksValidator;
//# sourceMappingURL=resource-links.js.map